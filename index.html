<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        video { width: 100%; border-radius: 10px; background: #000; margin-bottom: 15px; transform: scaleX(-1); } /* Ø¹ÙƒØ³ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙƒØ£Ù†Ù‡Ø§ Ù…Ø±Ø¢Ø© */
        button { padding: 15px 30px; background: #007bff; color: white; border: none; border-radius: 30px; font-size: 18px; cursor: pointer; width: 100%; margin-top: 10px; }
        button:disabled { background: #ccc; }
        #result { margin-top: 20px; font-size: 1.2em; font-weight: bold; color: #333; min-height: 50px; }
        .status { font-size: 0.9em; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ©º Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¬Ù„Ø¯</h2>
        <div class="status" id="status">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</div>
        
        <video id="webcam" autoplay playsinline muted></video>
        
        <div id="result">-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ --</div>
        <button id="runBtn" disabled>Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ</button>
    </div>

    <script src="./edge-impulse-standalone.js"></script>

    <script>
        const runBtn = document.getElementById('runBtn');
        const resultEl = document.getElementById('result');
        const statusEl = document.getElementById('status');
        let classifier;

        async function init() {
            try {
                // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø©
                if (!window.EdgeImpulseClassifier) {
                    throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (JS). ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹Ù‡ ÙˆØªØ³Ù…ÙŠØªÙ‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");
                }

                // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØµÙ†Ù
                classifier = new EdgeImpulseClassifier();
                await classifier.init();
                statusEl.innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²";

                // 3. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" }, // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©
                    audio: false 
                });
                document.getElementById('webcam').srcObject = stream;

                runBtn.disabled = false;

                // 4. Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
                runBtn.onclick = async () => {
                    resultEl.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";
                    try {
                        const res = await classifier.classify(document.getElementById('webcam'));
                        
                        if (res.results && res.results.length > 0) {
                            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©
                            const best = res.results.reduce((a, b) => a.value > b.value ? a : b);
                            resultEl.innerHTML = `Ø§Ù„ØªØ´Ø®ÙŠØµ: <span style="color:blue">${best.label}</span> <br> Ø§Ù„Ø¯Ù‚Ø©: ${Math.round(best.value * 100)}%`;
                        } else {
                            resultEl.innerText = "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø´ÙŠØ¡";
                        }
                    } catch (e) {
                        resultEl.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙ†ÙŠÙ";
                        console.error(e);
                    }
                };

            } catch (err) {
                console.error(err);
                statusEl.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£";
                resultEl.innerHTML = `<span style="color:red">${err.message || err}</span>`;
            }
        }

        init();
    </script>
</body>
</html>
