<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµØ§Ø¦Ø¯ Ø§Ù„Ø£Ø´Ø¨Ø§Ø­ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #status-box { 
            margin: 20px 0; padding: 15px; border-radius: 10px; 
            background: #fff3cd; color: #856404; font-weight: bold; word-break: break-all;
        }
        button { padding: 15px; width: 100%; border: none; border-radius: 10px; background: #ccc; color: white; font-weight: bold; font-size: 18px; }
        button.ready { background: #007bff; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ‘» ØµØ§Ø¦Ø¯ Ø§Ù„Ø£Ø´Ø¨Ø§Ø­</h2>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ÙÙŠ...</p>
        <div id="status-box">â³ Ù„Ø­Ø¸Ø© Ù…Ù† ÙØ¶Ù„Ùƒ...</div>
        <button id="btn" disabled>Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
    </div>

    <script>
        const statusBox = document.getElementById('status-box');
        const btn = document.getElementById('btn');
        
        // 1. ØªØ³Ø¬ÙŠÙ„ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù)
        window.initialKeys = Object.keys(window);

        // 2. ØµØ§Ø¦Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø®ÙÙŠØ©
        window.onerror = function(message, source, lineno, colno, error) {
            statusBox.innerHTML = `ğŸš¨ <b>ØªÙ… ÙƒØ´Ù Ø®Ø·Ø£:</b><br>${message}`;
            statusBox.style.background = "#f8d7da";
            statusBox.style.color = "#721c24";
            return true;
        };

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function analyzeMemory() {
            console.log("File loaded. Analyzing...");
            
            // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            const currentKeys = Object.keys(window);
            const newVars = currentKeys.filter(key => !window.initialKeys.includes(key));
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‡Ù…Ø©
            const ghosts = newVars.filter(k => k !== 'initialKeys' && k !== 'analyzeMemory' && k !== 'onerror');

            if (ghosts.length > 0) {
                // ÙˆØ¬Ø¯Ù†Ø§ Ø§Ù„Ù…ØªØºÙŠØ±!
                let foundName = ghosts[ghosts.length - 1]; // Ø¹Ø§Ø¯Ø© ÙŠÙƒÙˆÙ† Ø§Ù„Ø£Ø®ÙŠØ±
                statusBox.innerHTML = `âœ… <b>ÙˆØ¬Ø¯ØªÙ‡!</b><br>Ø§Ù„Ø§Ø³Ù… Ù‡Ùˆ: <span style="color:blue">${foundName}</span>`;
                statusBox.style.background = "#d4edda";
                statusBox.style.color = "#155724";
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ´Ù
                window.DetectedClass = window[foundName];
                btn.innerText = "ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¢Ù†";
                btn.classList.add('ready');
                btn.disabled = false;
                btn.onclick = startCamera;
            } else {
                statusBox.innerHTML = "ğŸ‘» <b>ØºØ±ÙŠØ¨!</b> Ø§Ù„Ù…Ù„Ù ØªØ­Ù…Ù„ Ù„ÙƒÙ†Ù‡ ÙØ§Ø±Øº Ø£Ùˆ Ù„Ù… ÙŠØ¶Ù Ø´ÙŠØ¦Ø§Ù‹.";
            }
        }

        async function startCamera() {
            document.body.innerHTML = '<video id="webcam" autoplay playsinline muted style="width:100%;border-radius:20px;"></video><div id="res" style="font-size:30px;font-weight:bold;margin-top:20px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>';
            const video = document.getElementById('webcam');
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            video.srcObject = stream;
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ´Ù
            const classifier = new window.DetectedClass();
            await classifier.init();
            
            setInterval(async () => {
                const res = await classifier.classify(video);
                if(res.results.length) {
                    const best = res.results.reduce((a, b) => a.value > b.value ? a : b);
                    document.getElementById('res').innerText = best.label + " (" + Math.round(best.value*100) + "%)";
                }
            }, 500);
        }
    </script>

    <script src="./edge-impulse-standalone.js?v=99" onload="analyzeMemory()"></script>

</body>
</html>
