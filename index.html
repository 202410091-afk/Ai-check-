<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ§Ø­Øµ Ø§Ù„Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f0f2f5; 
            color: #333; 
            text-align: center; 
            padding: 20px; 
            margin: 0;
        }
        h2 { color: #2c3e50; margin-bottom: 10px; }
        
        /* Ø¥Ø·Ø§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border: 5px solid #fff;
            background: #000;
            min-height: 300px;
        }
        
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        #result-box {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            font-size: 1.2rem;
            font-weight: bold;
            color: #555;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Ø§Ù„Ø²Ø± */
        button {
            margin-top: 20px;
            padding: 15px 40px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
            transition: transform 0.2s;
        }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <h2>ğŸ©º Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¬Ù„Ø¯</h2>
    
    <div class="video-container">
        <video id="webcam" autoplay playsinline muted></video>
    </div>

    <div id="result-box">Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„" Ø¨Ø§Ù„Ø£Ø³ÙÙ„ ğŸ‘‡</div>

    <button id="startBtn" onclick="startApp()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„</button>

    <script src="./edge-impulse-standalone.js"></script>

    <script>
        async function startApp() {
            const status = document.getElementById('result-box');
            const btn = document.getElementById('startBtn');
            const video = document.getElementById('webcam');

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            btn.style.display = 'none';
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…... (Ø§Ù†ØªØ¸Ø±)";
            status.style.color = "#e67e22"; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ

            try {
                // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" }, 
                    audio: false 
                });
                video.srcObject = stream;

                // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                status.innerText = "ğŸ§  Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡...";
                
                if (!window.EdgeImpulseClassifier) {
                    throw new Error("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¹Ø¯ØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
                }

                const classifier = new EdgeImpulseClassifier();
                await classifier.init();

                status.innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„! ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ø¬Ù„Ø¯";
                status.style.color = "#27ae60"; // Ø£Ø®Ø¶Ø±

                // 3. Ø­Ù„Ù‚Ø© Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø³ØªÙ…Ø±
                setInterval(async () => {
                    try {
                        const result = await classifier.classify(video);
                        
                        if (result.results && result.results.length > 0) {
                            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¹Ù„Ù‰
                            const topResult = result.results.reduce((prev, current) => {
                                return (prev.value > current.value) ? prev : current;
                            });

                            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø«Ù‚Ø© Ø£Ø¹Ù„Ù‰ Ù…Ù† 50%
                            if (topResult.value > 0.50) {
                                status.innerText = `ğŸ” ${topResult.label} (${Math.round(topResult.value * 100)}%)`;
                                status.style.color = "#333";
                            } else {
                                status.innerText = "ØºÙŠØ± Ù…ØªØ£ÙƒØ¯.. Ø§Ù‚ØªØ±Ø¨ Ø£ÙƒØ«Ø±";
                                status.style.color = "#7f8c8d";
                            }
                        }
                    } catch (e) {
                        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµÙ†ÙŠÙ:", e);
                    }
                }, 500); // ÙØ­Øµ ÙƒÙ„ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ©

            } catch (error) {
                status.innerHTML = "âš ï¸ Ø®Ø·Ø£: " + error.message;
                status.style.color = "red";
                btn.style.display = 'inline-block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                btn.innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
            }
        }
    </script>
</body>
</html>
