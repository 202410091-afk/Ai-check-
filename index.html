<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙØ­Øµ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #333; margin-bottom: 20px; }
        video { width: 100%; border-radius: 10px; background: #000; margin-bottom: 15px; }
        button { padding: 12px 25px; background: #007bff; color: white; border: none; border-radius: 25px; font-size: 16px; cursor: pointer; width: 100%; }
        button:disabled { background: #ccc; }
        #result { margin-top: 20px; font-size: 1.2em; font-weight: bold; color: #28a745; min-height: 1.5em; }
        .error { color: red; font-size: 0.9em; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ©º Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°ÙƒÙŠ (Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØµÙØ­)</h2>
        
        <video id="webcam" autoplay playsinline muted></video>
        <div id="result">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <button id="runBtn" disabled>Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ</button>
        <div id="errorMsg" class="error"></div>
    </div>

    <script src="edge-impulse-standalone.js"></script>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒÙ„Ø§Ø³ (ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ Ù†Ø³Ø®Ø© Browser)
        const runBtn = document.getElementById('runBtn');
        const resultEl = document.getElementById('result');
        const errorEl = document.getElementById('errorMsg');
        let classifier;

        async function init() {
            try {
                // 1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø©
                if (!window.EdgeImpulseClassifier) {
                    throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ù…Ù„Ù edge-impulse-standalone.js");
                }

                // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØµÙ†Ù
                classifier = new EdgeImpulseClassifier();
                await classifier.init();

                // 3. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" }, 
                    audio: false 
                });
                document.getElementById('webcam').srcObject = stream;

                resultEl.innerText = "Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² âœ…";
                runBtn.innerText = "Ø§Ù„ØªÙ‚Ø· ÙˆØ§ÙØ­Øµ";
                runBtn.disabled = false;

                // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
                runBtn.onclick = async () => {
                    resultEl.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";
                    try {
                        const res = await classifier.classify(document.getElementById('webcam'));
                        
                        if (res.results && res.results.length > 0) {
                            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙØ¶Ù„
                            const best = res.results.reduce((a, b) => a.value > b.value ? a : b);
                            resultEl.innerHTML = `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${best.label} <br> Ø§Ù„Ø«Ù‚Ø©: ${Math.round(best.value * 100)}%`;
                        } else {
                            resultEl.innerText = "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø´ÙŠØ¡";
                        }
                    } catch (e) {
                        resultEl.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙØ­Øµ";
                        console.error(e);
                    }
                };

            } catch (err) {
                console.error(err);
                resultEl.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£";
                errorEl.innerText = err.message;
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        init();
    </script>
</body>
</html>
